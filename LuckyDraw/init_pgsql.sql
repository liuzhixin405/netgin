-- ğŸ² æŠ½å¥–ç³»ç»Ÿæ•°æ®åº“åˆå§‹åŒ–è„šæœ¬ (PostgreSQL)

-- åˆ›å»ºæŠ½å¥–æ´»åŠ¨è¡¨
CREATE TABLE IF NOT EXISTS LuckyDrawActivities (
    Id INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    Name VARCHAR(200) NOT NULL,
    Description TEXT,
    Prize VARCHAR(500) NOT NULL,
    MaxParticipants INTEGER NOT NULL DEFAULT 100,
    CurrentParticipants INTEGER NOT NULL DEFAULT 0,
    WinnerCount INTEGER NOT NULL DEFAULT 1,
    Status INTEGER NOT NULL DEFAULT 0,
    CreatedAt TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    DrawTime TIMESTAMP NULL
);

COMMENT ON TABLE LuckyDrawActivities IS 'æŠ½å¥–æ´»åŠ¨è¡¨';
COMMENT ON COLUMN LuckyDrawActivities.Name IS 'æ´»åŠ¨åç§°';
COMMENT ON COLUMN LuckyDrawActivities.Description IS 'æ´»åŠ¨æè¿°';
COMMENT ON COLUMN LuckyDrawActivities.Prize IS 'å¥–å“';
COMMENT ON COLUMN LuckyDrawActivities.MaxParticipants IS 'æœ€å¤§å‚ä¸äººæ•°';
COMMENT ON COLUMN LuckyDrawActivities.CurrentParticipants IS 'å½“å‰å‚ä¸äººæ•°';
COMMENT ON COLUMN LuckyDrawActivities.WinnerCount IS 'è·å¥–è€…æ•°é‡';
COMMENT ON COLUMN LuckyDrawActivities.Status IS 'çŠ¶æ€: 0-æœªå¼€å§‹, 1-è¿›è¡Œä¸­, 2-å·²å®Œæˆ, 3-å·²å–æ¶ˆ';
COMMENT ON COLUMN LuckyDrawActivities.CreatedAt IS 'åˆ›å»ºæ—¶é—´';
COMMENT ON COLUMN LuckyDrawActivities.DrawTime IS 'å¼€å¥–æ—¶é—´';

CREATE INDEX IF NOT EXISTS idx_status ON LuckyDrawActivities (Status);
CREATE INDEX IF NOT EXISTS idx_created_at ON LuckyDrawActivities (CreatedAt);

-- åˆ›å»ºå‚ä¸è€…è¡¨
CREATE TABLE IF NOT EXISTS Participants (
    Id INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    ActivityId INTEGER NOT NULL,
    Name VARCHAR(100) NOT NULL,
    Contact VARCHAR(100) NOT NULL,
    LuckyNumber VARCHAR(20) NOT NULL,
    IsWinner BOOLEAN NOT NULL DEFAULT FALSE,
    JoinedAt TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT fk_activity FOREIGN KEY (ActivityId) REFERENCES LuckyDrawActivities (Id) ON DELETE CASCADE
);

COMMENT ON TABLE Participants IS 'å‚ä¸è€…è¡¨';
COMMENT ON COLUMN Participants.ActivityId IS 'æ´»åŠ¨ID';
COMMENT ON COLUMN Participants.Name IS 'å‚ä¸è€…åç§°';
COMMENT ON COLUMN Participants.Contact IS 'è”ç³»æ–¹å¼';
COMMENT ON COLUMN Participants.LuckyNumber IS 'å¹¸è¿å·ç ';
COMMENT ON COLUMN Participants.IsWinner IS 'æ˜¯å¦ä¸­å¥–';
COMMENT ON COLUMN Participants.JoinedAt IS 'å‚ä¸æ—¶é—´';

CREATE INDEX IF NOT EXISTS idx_activity_id ON Participants (ActivityId);
CREATE INDEX IF NOT EXISTS idx_is_winner ON Participants (IsWinner);
CREATE INDEX IF NOT EXISTS idx_lucky_number ON Participants (LuckyNumber);

-- æ’å…¥ç¤ºä¾‹æ•°æ®
INSERT INTO LuckyDrawActivities (Name, Description, Prize, MaxParticipants, WinnerCount, Status) VALUES
('ğŸ„ åœ£è¯èŠ‚æŠ½å¥–æ´»åŠ¨', 'å‚ä¸åœ£è¯èŠ‚æŠ½å¥–ï¼Œèµ¢å–ä¸°åšå¤§å¥–ï¼', 'iPhone 15 Pro Max', 1000, 3, 1),
('ğŸ§§ æ–°å¹´çº¢åŒ…é›¨', 'æ–°å¹´ç¦åˆ©ï¼Œäººäººæœ‰æœºä¼šï¼', '888å…ƒç°é‡‘çº¢åŒ…', 500, 10, 0);